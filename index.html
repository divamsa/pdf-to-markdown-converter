<!-- v2 - Cache Buster -->
<!DOCTYPE html>
<html lang="ja">
  <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
        <title>PDF to Markdown ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼</title>
      <style>
                * { margin: 0; padding: 0; box-sizing: border-box; }
                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
                .container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); max-width: 900px; width: 100%; padding: 40px; }
                .header { text-align: center; margin-bottom: 40px; }
                .header h1 { color: #333; font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
                .header p { color: #666; font-size: 1.1em; }
                .upload-area { border: 3px dashed #667eea; border-radius: 15px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: #f8f9ff; margin-bottom: 30px; }
                .upload-area:hover { border-color: #764ba2; background: #f0f1ff; transform: scale(1.02); }
                .upload-area.dragover { border-color: #764ba2; background: #e8ebff; box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
                .upload-icon { font-size: 3em; margin-bottom: 15px; }
                .button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-size: 1em; transition: all 0.3s ease; margin-top: 15px; }
                .button:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
                .button:disabled { opacity: 0.5; cursor: not-allowed; }
                .button-group { display: flex; gap: 15px; margin-top: 25px; justify-content: center; flex-wrap: wrap; }
                .btn-select { flex: 1; min-width: 150px; background: #667eea; }
                .btn-convert { flex: 1; min-width: 150px; background: #4caf50; display: none; }
                .btn-convert.active { display: inline-block; }
                .progress-section { margin-bottom: 30px; display: none; }
                .progress-section.active { display: block; }
                .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; margin-bottom: 10px; }
                .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: 0%; transition: width 0.3s ease; }
                .file-info { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; border-radius: 4px; margin-bottom: 20px; color: #1976d2; display: none; }
                .file-info.active { display: block; }
                .output-section { margin-top: 30px; display: none; }
                .output-section.active { display: block; }
                .tabs { display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 20px; gap: 10px; }
                .tab-button { background: none; border: none; padding: 12px 20px; cursor: pointer; color: #666; font-size: 1em; font-weight: 500; border-bottom: 3px solid transparent; transition: all 0.3s ease; }
                .tab-button.active { color: #667eea; border-bottom-color: #667eea; }
                .tab-content { display: none; }
                .tab-content.active { display: block; }
                .markdown-output { background: #f5f5f5; border-radius: 8px; padding: 20px; border: 1px solid #ddd; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.5; color: #333; }
                .download-buttons { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
                .download-btn { flex: 1; min-width: 150px; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-size: 0.95em; font-weight: 600; transition: all 0.3s ease; }
                .download-markdown { background: #4caf50; color: white; }
                .download-markdown:hover { background: #45a049; }
                .download-zip { background: #ff9800; color: white; }
                .download-zip:hover { background: #e68900; }
                .save-location { background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; border-radius: 4px; margin-top: 20px; color: #e65100; }
                .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
                .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; text-align: center; }
                .stat-card .number { font-size: 1.8em; font-weight: bold; }
            </style>
  </head>
  <body>
        <div class="container">
                  <div class="header">
                                <h1>ğŸ“„ PDF to Markdown</h1>
                              <p>PDFã‚’ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«Markdownã«å¤‰æ›ã—ã¾ã™</p>
                  </div>div>
                <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">ğŸ“¤</div>div>
                            <h2>PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h2>
                            <p>ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠã—ã¦ãã ã•ã„</p>
                            <input type="file" id="fileInput" style="display:none" accept=".pdf" />
                            <div class="button-group">
                                            <button class="button btn-select" onclick="document.getElementById('fileInput').click()">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>button>
                                            <button class="button btn-convert" id="convertBtn" onclick="startConversion()">ğŸ”„ Markdownã«å¤‰æ›</button>button>
                            </div>div>
                </div>div>
                <div class="file-info" id="fileInfo"></div>div>
                <div class="progress-section" id="progressSection">
                            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div>div></div>div>
                            <div style="color: #666; font-size: 0.9em; text-align: center;" id="progressText">å‡¦ç†ä¸­...</div>div>
                </div>div>
                <div class="output-section" id="outputSection">
                            <div class="stats" id="stats"></div>div>
                            <div class="tabs">
                                            <button class="tab-button active" onclick="switchTab('overview')">æ¦‚è¦</button>button>
                                            <button class="tab-button" onclick="switchTab('markdown')">Markdown</button>button>
                                            <button class="tab-button" onclick="switchTab('images')">å›³è¡¨</button>button>
                            </div>div>
                            <div id="overview" class="tab-content active" style="padding: 15px; background: #e3f2fd; border-radius: 4px;"></div>div>
                            <div id="markdown" class="tab-content"><div class="markdown-output" id="markdownOutput"></div>div></div>div>
                            <div id="images" class="tab-content"><div id="imagesContainer"></div>div></div>div>
                            <div class="download-buttons">
                                            <button class="download-btn download-markdown" onclick="downloadMarkdown()">ğŸ“ Markdownã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>button>
                                            <button class="download-btn download-zip" onclick="downloadAsZip()">ğŸ“¦ ZIPå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>button>
                            </div>div>
                            <div class="save-location">
                                            <strong>ğŸ’¾ ä¿å­˜å ´æ‰€:</strong><br/>
                                            <em>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã€Œãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ã€ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜ä½ç½®ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã«ã‚ˆã£ã¦ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</em>
                            </div>div>
                </div>div>
        </div>div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"><\/script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"><\/script>
      <script>
          let appState = { pdfData: null, sections: [], images: [], markdownContent: '', filename: '', file: null };
              const uploadArea = document.getElementById('uploadArea');
              const fileInput = document.getElementById('fileInput');
              uploadArea.addEventListener('click', () => fileInput.click());
              uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
              uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
              uploadArea.addEventListener('drop', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); if (e.dataTransfer.files.length > 0) handleFileSelect(e.dataTransfer.files[0]); });
              fileInput.addEventListener('change', e => { if (e.target.files.length > 0) handleFileSelect(e.target.files[0]); });
              function handleFileSelect(file) {
                            if (file.type !== 'application/pdf') { alert('PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™'); return; }
                                          appState.file = file;
                            appState.filename = file.name.replace('.pdf', '');
                            document.getElementById('fileInfo').innerHTML = '<strong>âœ… ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆã¿:</strong> ' + file.name + ' (' + (file.size / 1024 / 1024).toFixed(2) + ' MB)';
                            document.getElementById('fileInfo').classList.add('active');
                            document.getElementById('convertBtn').classList.add('active');
              }
              function startConversion() {
                            if (!appState.file) { alert('PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
                                          document.getElementById('progressSection').classList.add('active');
                            document.getElementById('outputSection').classList.remove('active');
                            processPDF(appState.file);
              }
              async function processPDF(file) {
                            try {
                                              const arrayBuffer = await file.arrayBuffer();
                                              const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                                              const totalPages = pdf.numPages;
                                              appState.sections = []; appState.images = [];
                                              for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                                                                    updateProgress(pageNum, totalPages);
                                                                    const page = await pdf.getPage(pageNum);
                                                                    const textContent = await page.getTextContent();
                                                                    const textItems = []; let currentLine = '';
                                                                    textContent.items.forEach(item => {
                                                                                              if (item.str) currentLine += item.str;
                                                                                              if (item.hasEOL) { if (currentLine.trim()) textItems.push(currentLine.trim()); currentLine = ''; }
                                                                    });
                                                                    if (currentLine.trim()) textItems.push(currentLine.trim());
                                                                                          const section = { pageNum, title: textItems.length > 0 && textItems[0].length < 100 ? textItems[0] : 'ãƒšãƒ¼ã‚¸ ' + pageNum, content: textItems.length > 0 && textItems[0].length < 100 ? textItems.slice(1) : textItems, imageRefs: [] };
                                                                    appState.sections.push(section);
                                                                    await extractImages(page, pageNum);
                                              }
                                              generateMarkdown();
                                              displayOutput();
                                              document.getElementById('outputSection').classList.add('active');
                            } catch (error) { alert('ã‚¨ãƒ©ãƒ¼: ' + error.message); console.error(error); }
              }
              async function extractImages(page, pageNum) {
                            try {
                                              const scale = 2;
                                              const viewport = page.getViewport({ scale });
                                              const canvas = document.createElement('canvas');
                                              const context = canvas.getContext('2d');
                                              canvas.width = viewport.width; canvas.height = viewport.height;
                                              await page.render({ canvasContext: context, viewport }).promise;
                                              const imageData = canvas.toDataURL('image/png');
                                              if (imageData.length > 1000) appState.images.push({ pageNum, data: imageData, filename: 'image_page_' + pageNum + '.png' });
                            } catch (error) { console.warn('ç”»åƒæŠ½å‡ºã‚¨ãƒ©ãƒ¼:', error); }
              }
              function generateMarkdown() {
                            let md = '# ' + appState.filename + '\n\n';
                            appState.sections.forEach((section, idx) => { md += '## ' + section.title + '\n\n*ãƒšãƒ¼ã‚¸: ' + section.pageNum + '*\n\n'; section.content.forEach(line => { md += line + '\n\n'; }); const pageImages = appState.images.filter(img => img.pageNum === section.pageNum); if (pageImages.length > 0) { md += '### å›³è¡¨\n\n'; pageImages.forEach((img, imgIdx) => { md += '![å›³è¡¨ ' + (imgIdx + 1) + '](./images/' + img.filename + ')\n\n'; }); } });
                            appState.markdownContent = md;
              }
              function updateProgress(current, total) {
                            const percentage = (current / total) * 100;
                            document.getElementById('progressFill').style.width = percentage + '%';
                            document.getElementById('progressText').textContent = 'å‡¦ç†ä¸­... ' + current + ' / ' + total + ' ãƒšãƒ¼ã‚¸ (' + Math.round(percentage) + '%)';
              }
              function displayOutput() {
                            document.getElementById('stats').innerHTML = '<div class="stat-card"><div class="number">' + appState.sections.length + '<\/div><div>ã‚»ã‚¯ã‚·ãƒ§ãƒ³<\/div><\/div><div class="stat-card"><div class="number">' + appState.images.length + '<\/div><div>å›³è¡¨<\/div><\/div>';
                            document.getElementById('overview').innerHTML = '<p><strong>âœ… ãƒ•ã‚¡ã‚¤ãƒ«å:<\/strong> ' + appState.filename + '.pdf<\/p><p><strong>ãƒšãƒ¼ã‚¸æ•°:<\/strong> ' + appState.sections.length + '<\/p><p><strong>å›³è¡¨æ•°:<\/strong> ' + appState.images.length + '<\/p>';
                            document.getElementById('markdownOutput').textContent = appState.markdownContent;
                            const imagesHTML = appState.images.map((img, idx) => '<div style="display:inline-block; margin: 10px; text-align: center;"><img src="' + img.data + '" style="max-width: 200px; border-radius: 8px;" /><p style="margin-top: 5px; font-size: 0.9em;">å›³è¡¨ ' + (idx + 1) + '<\/p><\/div>').join('');
                            document.getElementById('imagesContainer').innerHTML = imagesHTML || '<p style="text-align: center; color: #999;">å›³è¡¨ãŒã‚ã‚Šã¾ã›ã‚“<\/p>';
                            document.getElementById('progressSection').classList.remove('active');
              }
              function switchTab(tabName) {
                            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                            document.getElementById(tabName).classList.add('active');
                            event.target.classList.add('active');
              }
              function downloadMarkdown() {
                            const element = document.createElement('a');
                            element.setAttribute('href', 'data:text/markdown;charset=utf-8,' + encodeURIComponent(appState.markdownContent));
                            element.setAttribute('download', appState.filename + '.md');
                            element.style.display = 'none';
                            document.body.appendChild(element);
                            element.click();
                            document.body.removeChild(element);
              }
              async function downloadAsZip() {
                            const zip = new JSZip();
                            zip.file(appState.filename + '.md', appState.markdownContent);
                            if (appState.images.length > 0) {
                                              const imagesFolder = zip.folder('images');
                                              for (const img of appState.images) {
                                                                    const imageData = img.data.split(',')[1];
                                                                    imagesFolder.file(img.filename, imageData, { base64: true });
                                              }
                            }
                                          const content = await zip.generateAsync({ type: 'blob' });
                            const link = document.createElement('a');
                            link.href = URL.createObjectURL(content);
                            link.download = appState.filename + '-converted.zip';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
              }
          <\/script>
            </body>
            </html></em></strong></p></p></h1>
  </body>
      </style></title>
  </head>
